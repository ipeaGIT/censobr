<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Working with larger-than-memory data • censobr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Working with larger-than-memory data">
<meta name="robots" content="noindex">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">censobr</a>
        <span class="version label label-danger" data-toggle="tooltip" data-placement="bottom" title="In-development version">0.3.99999</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/censobr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles

    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/census_tracts_data.html">Census tract-level data</a>
    </li>
    <li>
      <a href="../articles/documentation.html">Census documentation</a>
    </li>
    <li>
      <a href="../articles/larger_than_memory.html">Working with larger-than-memory data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/censobr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Working with larger-than-memory data</h1>
            
            <h4 data-toc-skip class="date">2024-09-20</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/censobr/tree/main/vignettes/larger_than_memory.Rmd" class="external-link"><code>vignettes/larger_than_memory.Rmd</code></a></small>
      <div class="hidden name"><code>larger_than_memory.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="larger-than-memory-data">Larger-than-memory Data<a class="anchor" aria-label="anchor" href="#larger-than-memory-data"></a>
</h2>
<p>Many data sets of Brazilian censuses are too big to load in users’
RAM memory. To avoid this problem, <strong>{censobr}</strong> works with
files saved in <code>.parquet</code> format and, by default, the
functions in <strong>{censobr}</strong> returns an <a href="https://arrow.apache.org/docs/r/articles/arrow.html#tabular-data-in-arrow" class="external-link">Arrow
table</a> rather than a <code>data.frame</code>. There are a few really
simple alternative ways to work with Arrow tables in R without loading
the full data to memory. We cover four alternative approaches in this
vignette.</p>
<p>First, let’s read the 2010 mortality data, which we’ll use throughout
vignette for illustration purposes.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/censobr" class="external-link">censobr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># read 2010 mortality data</span></span>
<span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">censobr</span><span class="fu">::</span><span class="fu"><a href="../reference/read_mortality.html">read_mortality</a></span><span class="op">(</span></span>
<span>  year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>  add_labels <span class="op">=</span> <span class="st">'pt'</span>,</span>
<span>  showProgress <span class="op">=</span> <span class="cn">FALSE</span></span>
<span>  <span class="op">)</span></span></code></pre></div>
<div class="section level3">
<h3 id="dplyr">1. <code>{dplyr}</code><a class="anchor" aria-label="anchor" href="#dplyr"></a>
</h3>
<p>Because of the seamless integration between <a href="https://github.com/apache/arrow/" class="external-link">arrow</a> and
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>, Arrow tables can be analyzed pretty much like a
regular <code>data.frame</code> using the <a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>syntax.
There is a small but important difference, though. When using {dplyr}
with an Arrow table, the operations are not executed immediately.
Instead, {dplyr} builds a lazy query plan that is only evaluated when
you explicitly ask for the results. To retrieve the actual results, you
need to call either:</p>
<ul>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code>: This brings the results into memory as a
regular <code>data.frame</code>.</li>
<li>
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">compute()</a></code>: This materializes the result in the Arrow
format (e.g., as a new Arrow table).</li>
</ul>
<p>Without calling one of these, the query is just prepared but not
executed, which is useful for delaying heavy computations until
needed.</p>
<p>In the example below, we create a new Arrow table that only includes
the deaths records of men in the state of Rio de Janeiro without loading
the data to memory. Note that we only piece of data we
<code><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect()</a></code> (i.e. load to memory) here are the first
observations of the data.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter deaths of men in the state of Rio de Janeiro</span></span>
<span><span class="va">rio</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">V0704</span> <span class="op">==</span> <span class="st">'Masculino'</span> <span class="op">&amp;</span> <span class="va">abbrev_state</span> <span class="op">==</span> <span class="st">'RJ'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rio</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   code_muni code_state abbrev_state     name_state code_region name_region</span></span>
<span><span class="co">#&gt; 1   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 2   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 3   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 4   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 5   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 6   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt;   code_weighting V0001 V0002         V0011   V0300    V0010 V1001 V1002 V1003</span></span>
<span><span class="co">#&gt; 1  3300100003001    33 00100 3300100003001 1285657 13.51819     3    05   013</span></span>
<span><span class="co">#&gt; 2  3300100003001    33 00100 3300100003001 6084726 12.76395     3    05   013</span></span>
<span><span class="co">#&gt; 3  3300100003002    33 00100 3300100003002  898500 10.68108     3    05   013</span></span>
<span><span class="co">#&gt; 4  3300100003002    33 00100 3300100003002 2581116 11.61204     3    05   013</span></span>
<span><span class="co">#&gt; 5  3300100003002    33 00100 3300100003002 3768175 12.93833     3    05   013</span></span>
<span><span class="co">#&gt; 6  3300100003002    33 00100 3300100003002 4125020 10.66262     3    05   013</span></span>
<span><span class="co">#&gt;   V1004  V1006             V0703     V0704 V7051 V7052 M0703 M0704 M7051 M7052</span></span>
<span><span class="co">#&gt; 1    00 Urbana     Março de 2010 Masculino    69    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 2    00 Urbana Fevereiro de 2010 Masculino    84    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 3    00 Urbana     Abril de 2010 Masculino    38    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 4    00 Urbana      Maio de 2010 Masculino    54    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 5    00  Rural    Agosto de 2009 Masculino    31    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 6    00 Urbana  Setembro de 2009 Masculino    28    NA     2     2     2     2</span></span>
<span><span class="co">#&gt;                                   V1005</span></span>
<span><span class="co">#&gt; 1                       Área urbanizada</span></span>
<span><span class="co">#&gt; 2                   Área não urbanizada</span></span>
<span><span class="co">#&gt; 3                       Área urbanizada</span></span>
<span><span class="co">#&gt; 4                       Área urbanizada</span></span>
<span><span class="co">#&gt; 5 Área rural exclusive aglomerado rural</span></span>
<span><span class="co">#&gt; 6                       Área urbanizada</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="duckdb">2. <code>{duckdb}</code><a class="anchor" aria-label="anchor" href="#duckdb"></a>
</h3>
<p><a href="https://r.duckdb.org/" class="external-link">duckdb</a> is another powerful library to work with
larger-than-memory data in R through database interface. There are
different ways to use <a href="https://r.duckdb.org/" class="external-link">duckdb</a>, but here cover three
alternatives</p>
<div class="section level4">
<h4 id="combining-duckdb-dplyr">2.1 Combining <code>{duckdb}</code> &amp; <code>{dplyr}</code><a class="anchor" aria-label="anchor" href="#combining-duckdb-dplyr"></a>
</h4>
<p>One easy option is to combine <a href="https://r.duckdb.org/" class="external-link">duckdb</a> &amp;
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>. Note here that first you need to convert the Arrow
table into a DuckDB table with <code><a href="https://arrow.apache.org/docs/r/reference/to_duckdb.html" class="external-link">arrow::to_duckdb()</a></code>. Also
note that the you need to use a bit of <code>SQL</code> syntax inside
the dplyr call. Using the same example as above:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter deaths of men in the state of Rio de Janeiro</span></span>
<span><span class="va">rio1</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">arrow</span><span class="fu">::</span><span class="fu"><a href="https://arrow.apache.org/docs/r/reference/to_duckdb.html" class="external-link">to_duckdb</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/sql.html" class="external-link">sql</a></span><span class="op">(</span><span class="st">"V0704 LIKE '%Masculino%' AND abbrev_state = 'RJ'"</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rio1</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 26</span></span></span>
<span><span class="co">#&gt;   code_muni code_state abbrev_state name_state     code_region name_region</span></span>
<span><span class="co">#&gt;       <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>      <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>                <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>      </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span>   3<span style="text-decoration: underline;">300</span>100         33 RJ           Rio de Janeiro           3 Sudeste    </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># ℹ 20 more variables: code_weighting &lt;chr&gt;, V0001 &lt;chr&gt;, V0002 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   V0011 &lt;chr&gt;, V0300 &lt;dbl&gt;, V0010 &lt;dbl&gt;, V1001 &lt;chr&gt;, V1002 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   V1003 &lt;chr&gt;, V1004 &lt;chr&gt;, V1006 &lt;chr&gt;, V0703 &lt;chr&gt;, V0704 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   V7051 &lt;dbl&gt;, V7052 &lt;dbl&gt;, M0703 &lt;chr&gt;, M0704 &lt;chr&gt;, M7051 &lt;chr&gt;,</span></span></span>
<span><span class="co">#&gt; <span style="color: #949494;">#   M7052 &lt;chr&gt;, V1005 &lt;chr&gt;</span></span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="combining-duckdb-sql">2.2 Combining <code>{duckdb}</code> &amp; <code>SQL</code><a class="anchor" aria-label="anchor" href="#combining-duckdb-sql"></a>
</h4>
<p>Another alternative is to combine <a href="https://r.duckdb.org/" class="external-link">duckdb</a> with
<a href="https://dbi.r-dbi.org" class="external-link">DBI</a> using database interface and <code>SQL</code>
syntax.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r.duckdb.org/" class="external-link">duckdb</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dbi.r-dbi.org" class="external-link">DBI</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create databse connection</span></span>
<span><span class="va">con</span> <span class="op">&lt;-</span> <span class="fu">duckdb</span><span class="fu">::</span><span class="fu">dbConnect</span><span class="op">(</span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb.html" class="external-link">duckdb</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># register the data in the data base</span></span>
<span><span class="fu">duckdb</span><span class="fu">::</span><span class="fu"><a href="https://r.duckdb.org/reference/duckdb_register_arrow.html" class="external-link">duckdb_register_arrow</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">'mortality_2010_tbl'</span>, <span class="va">df</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># Filter deaths of men in the state of Rio de Janeiro</span></span>
<span><span class="va">rio2</span> <span class="op">&lt;-</span> <span class="fu">DBI</span><span class="fu">::</span><span class="fu"><a href="https://dbi.r-dbi.org/reference/dbGetQuery.html" class="external-link">dbGetQuery</a></span><span class="op">(</span><span class="va">con</span>, <span class="st">"SELECT * FROM 'mortality_2010_tbl' WHERE V0704 LIKE '%Masculino%' AND abbrev_state = 'RJ'"</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rio2</span><span class="op">)</span></span>
<span><span class="co">#&gt;   code_muni code_state abbrev_state     name_state code_region name_region</span></span>
<span><span class="co">#&gt; 1   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 2   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 3   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 4   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 5   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 6   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt;   code_weighting V0001 V0002         V0011   V0300    V0010 V1001 V1002 V1003</span></span>
<span><span class="co">#&gt; 1  3300100003001    33 00100 3300100003001 1285657 13.51819     3    05   013</span></span>
<span><span class="co">#&gt; 2  3300100003001    33 00100 3300100003001 6084726 12.76395     3    05   013</span></span>
<span><span class="co">#&gt; 3  3300100003002    33 00100 3300100003002  898500 10.68108     3    05   013</span></span>
<span><span class="co">#&gt; 4  3300100003002    33 00100 3300100003002 2581116 11.61204     3    05   013</span></span>
<span><span class="co">#&gt; 5  3300100003002    33 00100 3300100003002 3768175 12.93833     3    05   013</span></span>
<span><span class="co">#&gt; 6  3300100003002    33 00100 3300100003002 4125020 10.66262     3    05   013</span></span>
<span><span class="co">#&gt;   V1004  V1006             V0703     V0704 V7051 V7052 M0703 M0704 M7051 M7052</span></span>
<span><span class="co">#&gt; 1    00 Urbana     Março de 2010 Masculino    69    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 2    00 Urbana Fevereiro de 2010 Masculino    84    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 3    00 Urbana     Abril de 2010 Masculino    38    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 4    00 Urbana      Maio de 2010 Masculino    54    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 5    00  Rural    Agosto de 2009 Masculino    31    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 6    00 Urbana  Setembro de 2009 Masculino    28    NA     2     2     2     2</span></span>
<span><span class="co">#&gt;                                   V1005</span></span>
<span><span class="co">#&gt; 1                       Área urbanizada</span></span>
<span><span class="co">#&gt; 2                   Área não urbanizada</span></span>
<span><span class="co">#&gt; 3                       Área urbanizada</span></span>
<span><span class="co">#&gt; 4                       Área urbanizada</span></span>
<span><span class="co">#&gt; 5 Área rural exclusive aglomerado rural</span></span>
<span><span class="co">#&gt; 6                       Área urbanizada</span></span></code></pre></div>
</div>
<div class="section level4">
<h4 id="duckplyr">2.3 <code>{duckplyr}</code><a class="anchor" aria-label="anchor" href="#duckplyr"></a>
</h4>
<p>A third alternative is the new <a href="https://duckdblabs.github.io/duckplyr/" class="external-link">duckplyr</a> package. This
this library is under development so it still does not cover many of the
<a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a>verbs. (See <a href="https://duckdb.org/2024/04/02/duckplyr.html" class="external-link">here</a>).
Nonetheless, it looks like a really promising and seamless approach that
allow users to leverage the powerful capabilities of {duckdb}.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://duckdblabs.github.io/duckplyr/" class="external-link">duckplyr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="va">rio3</span> <span class="op">&lt;-</span> <span class="va">df</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu">duckplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">V0704</span> <span class="op">==</span> <span class="st">'Masculino'</span> <span class="op">&amp;</span> <span class="va">abbrev_state</span> <span class="op">==</span> <span class="st">'RJ'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rio3</span><span class="op">)</span> <span class="op">|&gt;</span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span><span class="co">#&gt;   code_muni code_state abbrev_state     name_state code_region name_region</span></span>
<span><span class="co">#&gt; 1   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 2   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 3   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 4   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 5   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt; 6   3300100         33           RJ Rio de Janeiro           3     Sudeste</span></span>
<span><span class="co">#&gt;   code_weighting V0001 V0002         V0011   V0300    V0010 V1001 V1002 V1003</span></span>
<span><span class="co">#&gt; 1  3300100003001    33 00100 3300100003001 1285657 13.51819     3    05   013</span></span>
<span><span class="co">#&gt; 2  3300100003001    33 00100 3300100003001 6084726 12.76395     3    05   013</span></span>
<span><span class="co">#&gt; 3  3300100003002    33 00100 3300100003002  898500 10.68108     3    05   013</span></span>
<span><span class="co">#&gt; 4  3300100003002    33 00100 3300100003002 2581116 11.61204     3    05   013</span></span>
<span><span class="co">#&gt; 5  3300100003002    33 00100 3300100003002 3768175 12.93833     3    05   013</span></span>
<span><span class="co">#&gt; 6  3300100003002    33 00100 3300100003002 4125020 10.66262     3    05   013</span></span>
<span><span class="co">#&gt;   V1004  V1006             V0703     V0704 V7051 V7052 M0703 M0704 M7051 M7052</span></span>
<span><span class="co">#&gt; 1    00 Urbana     Março de 2010 Masculino    69    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 2    00 Urbana Fevereiro de 2010 Masculino    84    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 3    00 Urbana     Abril de 2010 Masculino    38    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 4    00 Urbana      Maio de 2010 Masculino    54    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 5    00  Rural    Agosto de 2009 Masculino    31    NA     2     2     2     2</span></span>
<span><span class="co">#&gt; 6    00 Urbana  Setembro de 2009 Masculino    28    NA     2     2     2     2</span></span>
<span><span class="co">#&gt;                                   V1005</span></span>
<span><span class="co">#&gt; 1                       Área urbanizada</span></span>
<span><span class="co">#&gt; 2                   Área não urbanizada</span></span>
<span><span class="co">#&gt; 3                       Área urbanizada</span></span>
<span><span class="co">#&gt; 4                       Área urbanizada</span></span>
<span><span class="co">#&gt; 5 Área rural exclusive aglomerado rural</span></span>
<span><span class="co">#&gt; 6                       Área urbanizada</span></span></code></pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

      </div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rafael H. M. Pereira, Rogério J. Barbosa, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

      </footer>
</div>






  </body>
</html>
