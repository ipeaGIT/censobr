<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Introduction to censobr • censobr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Introduction to censobr">
<meta property="og:description" content="censobr">
<meta property="og:image" content="/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">censobr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/censobr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/ipeaGIT/censobr/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Introduction to censobr</h1>
            
            <h4 data-toc-skip class="date">2023-09-04</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/ipeaGIT/censobr/blob/HEAD/vignettes/censobr.Rmd" class="external-link"><code>vignettes/censobr.Rmd</code></a></small>
      <div class="hidden name"><code>censobr.Rmd</code></div>

    </div>

    
    
<p><strong>censobr</strong> is an R package to download data from
Brazil’s Population Census. The package is built on top of the <a href="https://arrow.apache.org/docs/r/" class="external-link">Arrow platform</a>, which allows
users to work with larger-than-memory census data using <a href="https://arrow.apache.org/docs/r/articles/arrow.html#analyzing-arrow-data-with-dplyr" class="external-link">{dplyr}
familiar functions</a>.</p>
<p><em>obs.:</em> The package is still under development. At the moment,
censobr only includes microdata from the 2000 and 2010 censuses, but it
is being expanded to cover more years and data sets.</p>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># or use the development version with latest features</span></span>
<span><span class="fu">utils</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/r/utils/remove.packages.html" class="external-link">remove.packages</a></span><span class="op">(</span><span class="st">'censobr'</span><span class="op">)</span></span>
<span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"ipeaGIT/censobr"</span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/censobr" class="external-link">censobr</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="basic-usage">Basic usage<a class="anchor" aria-label="anchor" href="#basic-usage"></a>
</h2>
<p>The package currently includes 5 main functions to download Census
microdata:</p>
<ol style="list-style-type: decimal">
<li><code><a href="../reference/read_population.html">read_population()</a></code></li>
<li><code><a href="../reference/read_households.html">read_households()</a></code></li>
<li><code><a href="../reference/read_mortality.html">read_mortality()</a></code></li>
<li><code><a href="../reference/read_families.html">read_families()</a></code></li>
<li><code><a href="../reference/read_emmigration.html">read_emmigration()</a></code></li>
</ol>
<p>The syntax of all <strong>censobr</strong> functions operate on the
same logic so it becomes intuitive to download any data set using a
single line of code. Like this:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">dfh</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_households.html">read_households</a></span><span class="op">(</span></span>
<span>          <span class="va">year</span>,          <span class="co"># year of reference</span></span>
<span>          <span class="va">columns</span>,       <span class="co"># whether to return only selected columns</span></span>
<span>          <span class="va">add_labels</span>,    <span class="co"># whether to add labels to cateogrical variables</span></span>
<span>          <span class="va">as_data_frame</span>, <span class="co"># whether to return an Arrow DataSet or a data.frame</span></span>
<span>          <span class="va">showProgress</span>,  <span class="co"># whether to show a download progress bar</span></span>
<span>          <span class="va">cache</span>          <span class="co"># whether to cache data for faster access later</span></span>
<span>         <span class="op">)</span></span></code></pre></div>
<p><strong><em>Note:</em></strong> all data sets in
<strong>censobr</strong> are enriched with geography columns following
the name standards of the <a href="https://github.com/ipeaGIT/geobr/" class="external-link">{geobr} package</a> to help
data manipulation and integration with spatial data from the {geobr}
package. The added columns are:
<code>c(‘code_muni’, ‘code_state’, ‘abbrev_state’, ‘name_state’, ‘code_region’, ‘name_region’, ‘code_weighting’)</code>.</p>
<div class="section level3">
<h3 id="data-cache">Data cache<a class="anchor" aria-label="anchor" href="#data-cache"></a>
</h3>
<p>The first time the user runs a function, <strong>censobr</strong>
will download the file and store it locally. This way, the data only
needs to be downloaded once. When the <code>cache</code> parameter is
set to <code>TRUE</code> (Default), the function will read the cached
data, which is much faster.</p>
<p>Users can list and/or delete data files cached locally using the
<code><a href="../reference/censobr_cache.html">censobr_cache()</a></code> function:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/censobr" class="external-link">censobr</a></span><span class="op">)</span></span>
<span></span>
<span><span class="co"># list cached files</span></span>
<span><span class="fu"><a href="../reference/censobr_cache.html">censobr_cache</a></span><span class="op">(</span>list_files <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Files currently chached:</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2000_families.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_deaths.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_emmigration.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_households.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_population.parquet</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># delete particular file</span></span>
<span><span class="fu"><a href="../reference/censobr_cache.html">censobr_cache</a></span><span class="op">(</span>delete_file <span class="op">=</span> <span class="st">"2010_emmigration"</span><span class="op">)</span></span>
<span><span class="co">#&gt; The file '2010_emmigration' has been removed.</span></span>
<span><span class="co">#&gt; Files currently chached:</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2000_families.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_deaths.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_households.parquet</span></span>
<span><span class="co">#&gt; /home/runner/.cache/R/censobr_v0.1.0/2010_population.parquet</span></span></code></pre></div>
</div>
</div>
<div class="section level2">
<h2 id="larger-than-memory-data">Larger-than-memory Data<a class="anchor" aria-label="anchor" href="#larger-than-memory-data"></a>
</h2>
<p>Microdata of Brazilian census are often be too big to load in users’
RAM memory. To avoid this problem, <strong>censobr</strong> will by
default return an <a href="https://arrow.apache.org/docs/r/articles/arrow.html#tabular-data-in-arrow" class="external-link">Arrow
table</a>, which can be analyzed like a regular <code>data.frame</code>
using the <code>dplyr</code> package without loading the full data to
memory.</p>
<p>Let’s see how it works in a couple examples:</p>
</div>
<div class="section level2">
<h2 id="reproducible-examples">Reproducible examples<a class="anchor" aria-label="anchor" href="#reproducible-examples"></a>
</h2>
<p>First, let’s load the libraries we’ll be using in this vignette.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/censobr" class="external-link">censobr</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/apache/arrow/" class="external-link">arrow</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'arrow'</span></span>
<span><span class="co">#&gt; The following object is masked from 'package:utils':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     timestamp</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://dplyr.tidyverse.org" class="external-link">dplyr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; Attaching package: 'dplyr'</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:stats':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     filter, lag</span></span>
<span><span class="co">#&gt; The following objects are masked from 'package:base':</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt;     intersect, setdiff, setequal, union</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/ipeaGIT/geobr" class="external-link">geobr</a></span><span class="op">)</span></span>
<span><span class="co">#&gt; Loading required namespace: sf</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span></code></pre></div>
<div class="section level4">
<h4 id="using-population-data">Using Population data:<a class="anchor" aria-label="anchor" href="#using-population-data"></a>
</h4>
<p>In this example we’ll be calculating the proportion of people with
higher education in different racial groups in the state of Rio de
Janeiro. First, we need to use the <code><a href="../reference/read_population.html">read_population()</a></code>
function to download the population data set.</p>
<p>Since we don’t need to load to memory all columns from the data, we
can pass a vector the the columns we’re going to use. This might be
necessary in more constrained computing environments.</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pop</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_population.html">read_population</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2010</span>,</span>
<span>                       columns <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">'abbrev_state'</span>, <span class="st">'V0606'</span>, <span class="st">'V0010'</span>, <span class="st">'V6400'</span><span class="op">)</span>,</span>
<span>                       add_labels <span class="op">=</span> <span class="st">'pt'</span>,</span>
<span>                       showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading data cached locally.</span></span></code></pre></div>
<p>Next, we use the <code>dplyr</code> syntax to (a) filter observations
for the state of Rio de Janeiro, (b) group observations by racial group,
(c) summarize the data calculating the proportion of individuals with
higher education.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="va">pop</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">abbrev_state</span> <span class="op">==</span> <span class="st">"RJ"</span><span class="op">)</span> <span class="op">|&gt;</span>                                   <span class="co"># (a)</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">V0606</span><span class="op">)</span> <span class="op">|&gt;</span>                                                <span class="co"># (b)</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>higher_edu <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">V0010</span><span class="op">[</span><span class="fu"><a href="https://rdrr.io/r/base/which.html" class="external-link">which</a></span><span class="op">(</span><span class="va">V6400</span><span class="op">==</span><span class="st">"Superior completo"</span><span class="op">)</span><span class="op">]</span><span class="op">)</span> <span class="op">/</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">V0010</span><span class="op">)</span>, <span class="co"># (c)</span></span>
<span>                pop <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="va">V0010</span><span class="op">)</span> <span class="op">)</span> <span class="op">|&gt;</span></span>
<span>      <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 3</span></span></span>
<span><span class="co">#&gt;   V0606    higher_edu      pop</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>         <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> Amarela      0.078<span style="text-decoration: underline;">2</span>  <span style="text-decoration: underline;">122</span>552.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> Branca       0.151  7<span style="text-decoration: underline;">579</span>023.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> Ignorado     0         <span style="text-decoration: underline;">3</span>397.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> Indígena     0.109    <span style="text-decoration: underline;">15</span>258.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> Parda        0.044<span style="text-decoration: underline;">3</span> 6<span style="text-decoration: underline;">332</span>408.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> Preta        0.040<span style="text-decoration: underline;">5</span> 1<span style="text-decoration: underline;">937</span>291.</span></span></code></pre></div>
<p>Now we only need to plot the results.</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/subset.html" class="external-link">subset</a></span><span class="op">(</span><span class="va">df</span>, <span class="va">V0606</span> <span class="op">!=</span> <span class="st">'Ignorado'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_bar.html" class="external-link">geom_col</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V0606</span>, y<span class="op">=</span><span class="va">higher_edu</span><span class="op">)</span>, fill <span class="op">=</span> <span class="st">'#5c997e'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_continuous.html" class="external-link">scale_y_continuous</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">'Proportion with higher education'</span>,</span>
<span>                     labels <span class="op">=</span> <span class="fu">scales</span><span class="fu">::</span><span class="va"><a href="https://scales.r-lib.org/reference/percent_format.html" class="external-link">percent</a></span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html" class="external-link">labs</a></span><span class="op">(</span>x <span class="op">=</span> <span class="st">'Cor/raça'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_classic</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="censobr_files/figure-html/unnamed-chunk-8-1.png" width="100%"></p>
</div>
<div class="section level4">
<h4 id="using-household-data">Using household data:<a class="anchor" aria-label="anchor" href="#using-household-data"></a>
</h4>
<p>In this example, we are going to map how much people spend with rent
across different states in Brazil. First, we can easily download the
households data set with the <code><a href="../reference/read_households.html">read_households()</a></code>
function.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">hs</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_households.html">read_households</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2010</span>, </span>
<span>                      showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Reading data cached locally.</span></span></code></pre></div>
<p>Now we’re going to (a) group observations by state, (b) calculate the
average rent, and (c) collect the results.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">rent</span> <span class="op">&lt;-</span> <span class="va">hs</span> <span class="op">|&gt;</span> </span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span> <span class="op">|&gt;</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">code_state</span><span class="op">)</span> <span class="op">|&gt;</span>                                            <span class="co"># (a)</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>avgrent<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/weighted.mean.html" class="external-link">weighted.mean</a></span><span class="op">(</span>x<span class="op">=</span><span class="va">V2011</span>, w<span class="op">=</span><span class="va">V0010</span>, na.rm<span class="op">=</span><span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span>  <span class="co"># (b)</span></span>
<span>        <span class="fu"><a href="https://dplyr.tidyverse.org/reference/compute.html" class="external-link">collect</a></span><span class="op">(</span><span class="op">)</span>                                                          <span class="co"># (c)</span></span>
<span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">rent</span><span class="op">)</span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 6 × 2</span></span></span>
<span><span class="co">#&gt;   code_state avgrent</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span>        <span style="color: #949494; font-style: italic;">&lt;dbl&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> 11            340.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> 12            295.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">3</span> 13            346.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">4</span> 14            298.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">5</span> 15            297.</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">6</span> 16            322.</span></span></code></pre></div>
<p>In order to create a map with of these values, we are going to use
the <code>geobr</code> package to download the geometries of Brazilian
states.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uf</span> <span class="op">&lt;-</span> <span class="fu">geobr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/geobr/man/read_state.html" class="external-link">read_state</a></span><span class="op">(</span>year <span class="op">=</span> <span class="fl">2010</span>, </span>
<span>                        showProgress <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; Using year 2010</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">uf</span><span class="op">)</span></span>
<span><span class="co">#&gt; Simple feature collection with 6 features and 5 fields</span></span>
<span><span class="co">#&gt; Geometry type: MULTIPOLYGON</span></span>
<span><span class="co">#&gt; Dimension:     XY</span></span>
<span><span class="co">#&gt; Bounding box:  xmin: -73.99045 ymin: -13.6937 xmax: -46.06095 ymax: 5.271841</span></span>
<span><span class="co">#&gt; Geodetic CRS:  SIRGAS 2000</span></span>
<span><span class="co">#&gt;   code_state abbrev_state name_state code_region name_region</span></span>
<span><span class="co">#&gt; 1         11           RO   Rondônia           1       Norte</span></span>
<span><span class="co">#&gt; 2         12           AC       Acre           1       Norte</span></span>
<span><span class="co">#&gt; 3         13           AM   Amazonas           1       Norte</span></span>
<span><span class="co">#&gt; 4         14           RR    Roraima           1       Norte</span></span>
<span><span class="co">#&gt; 5         15           PA       Pará           1       Norte</span></span>
<span><span class="co">#&gt; 6         16           AP      Amapá           1       Norte</span></span>
<span><span class="co">#&gt;                             geom</span></span>
<span><span class="co">#&gt; 1 MULTIPOLYGON (((-63.32721 -...</span></span>
<span><span class="co">#&gt; 2 MULTIPOLYGON (((-73.18253 -...</span></span>
<span><span class="co">#&gt; 3 MULTIPOLYGON (((-67.32609 2...</span></span>
<span><span class="co">#&gt; 4 MULTIPOLYGON (((-60.20051 5...</span></span>
<span><span class="co">#&gt; 5 MULTIPOLYGON (((-54.95431 2...</span></span>
<span><span class="co">#&gt; 6 MULTIPOLYGON (((-51.1797 4....</span></span></code></pre></div>
<p>Now we only need to merge the spatial data with our rent estimates
and map the results.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">uf</span><span class="op">$</span><span class="va">code_state</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">uf</span><span class="op">$</span><span class="va">code_state</span><span class="op">)</span></span>
<span><span class="va">rent_sf</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://dplyr.tidyverse.org/reference/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">uf</span>, <span class="va">rent</span>, by <span class="op">=</span> <span class="st">'code_state'</span><span class="op">)</span></span>
<span></span>
<span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html" class="external-link">ggplot</a></span><span class="op">(</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsf.html" class="external-link">geom_sf</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">rent_sf</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>fill <span class="op">=</span> <span class="va">avgrent</span><span class="op">)</span>, color<span class="op">=</span><span class="cn">NA</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/scale_brewer.html" class="external-link">scale_fill_distiller</a></span><span class="op">(</span>palette <span class="op">=</span> <span class="st">"Oranges"</span>, direction <span class="op">=</span> <span class="fl">1</span>, </span>
<span>                       name<span class="op">=</span><span class="st">'Avgerage\nRent in R$'</span><span class="op">)</span> <span class="op">+</span></span>
<span>  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_void</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="censobr_files/figure-html/unnamed-chunk-12-1.png" width="100%"></p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Rafael H. M. Pereira, Ipea - Institute for Applied Economic Research.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
